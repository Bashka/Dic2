Полиморфизм и перегрузка.
Перегрузка операторов
=====================

В Perl есть возможность перегрузить некоторые операторы с помощью прагмы overload. Реализуется это следующим образом:

    use overload('<оператор>' => \&<метод>, ...);

В параметрах прагмы overload перечисляются перегружаемые операторы и ссылки на методы, вызываемые для перегрузки.

При выполнении перегружаемой оператор функции в нее передается три параметра:

* Первый содержит ссылку на левый операнд;
* Второй содержит ссылку на правый операнд;
* Третий содержит информацию о том, является ли операция транспонентной, то есть меняется ли результат от перестановки операндов или нет.

Ниже приведен пример перегрузки оператора сложения для класса:

    use overload('+' => \&summ);
    sub summ(){
      return $_[0]->new($_[0]->getA() + $_[1]->getA());
    }

Здесь используется перегрузка оператора + и метод summ для ее реализации. Метод создает новый объект того же класса, что и левый операнд, и передает ему в качестве первого параметра результат сложения свойств 'a' объектов.

Ниже приведен список всех перегружаемых операторов в Perl:

* `""` - преобразование в строку;
* `0+` - преобразование в число;
* `bool` - преобразование в логический тип;
* `+ - * / ** % x .` - операторы над числами и строками;
* `!` - оператор НЕ;
* `++ --` - инкремент и декремент;
* `+= -= *= /= **= %* .= x=` - операторы с присваиванием;
* `== != > >= < <= <=> lt le gt ge eq ne` - операторы сравнения;
* `<>` - итеративный оператор;
* `${} @{} %{} &{}` - операторы разыменования.

Перегрузка переменных
=====================

В Perl существует возможность связывать переменные с классами так, что выполнения над ними операций заменяется вызовом методов этих классов.

Для связывания используется операция tie:

    tie(<переменная>, <класс>, [<параметры>]);

При этом вызывается специальный конструктор, соответствующий типу связываемой "переменной" указанного "класса", которому передаются дополнительные "параметры" для связывания, если они указаны.

Важно помнить, что функция tie не выполняет загрузку используемого "класса", это необходимо сделать самостоятельно перед ее вызовом с помощью use.

После связывания, переменная дополняется специальным объектом, который и используется при работе с этой переменной. Для получения этого объекта используется функция tied:

    <переменная> = tied(<связаннаяПеременная>);

Получаемый в результате объект можно использовать аналогично любому другому объекту, вызывая у него методы через ->.

Связывание скалярных переменных
-------------------------------

Связываемый класс для скалярной переменной должен включать следующие методы:

* TIESCALAR - конструктор объекта. В качестве первого параметра он получает имя класса, а в качестве остальных параметров, дополнительные параметры, передаваемые в tie;
* STORE - метод, вызываемый при записи значения переменной. В качестве первого параметра он получает объект, а в качестве второго - записываемое значение;
* FETCH - метод, вызываемый при получении значения из переменной. В качестве первого параметра он получает объект.

Конструктор этого класса должен создавать и возвращать объектную ссылку как для обычных классов (с помощью функции bless, на пример).

Ниже приведен пример класса, реализующего стандартное поведение скалярных переменных и его использование:

    package My;
    sub TIESCALAR(){
      return bless(\my $self, shift(@_)); # Создание и возврат объекта. В качестве основы используется ссылка на скаляр.
    }
    sub STORE(){
      $$_[0] = $_[1]; # Запись переданного значения объекту.
    }
    sub FETCH(){
      return $$_[0]; # Получение значения из объекта.
    }
    # Использование класса.
    tie($str, 'My'); # Вызов метода My::TIESCALAR.
    $str = 'Hello world'; # Вызов метода My::STORE.
    print $str; # Вызов метода My::FETCH.

Связывание массивов
-------------------

Связываемый класс для массива должен включать следующие методы:

* TIEARRAY - конструктор объекта. В качестве первого параметра он получает имя класса, а в качестве остальных параметров, дополнительные параметры, передаваемые в tie;
* STORE - метод, вызываемый при записи значения элементу массива. В качестве первого параметра он получает объект, в качестве второго - индекс элемента; а в качестве третьего - записываемое значение;
* FETCH - метод, вызываемый при получении значения из элемента массива. В качестве первого параметра он получает объект, а в качестве второго - индекс целевого элемента;
* FETCHSIZE - метод должен возвращать количество элементов в данном массиве. В качестве первого параметра ему передается объект;
* STORESIZE - метод должен устанавливать максимальное число элементов для данного массива. В качестве первого параметра ему передается объект;
* EXTEND - метод должен расширить массив до указанной длины. В качестве первого параметра ему передается объект, а в качестве второго - целевой размер массива;
* EXISTS - метод должен возвращать true - если элемент с указанным индексом задан в массиве. В качестве первого параметра ему передается объект, а в качестве второго - индекс проверяемого элемента;
* DELETE - метод должен удалять указанный элемент из массива. В качестве первого параметра ему передается объект, а в качестве второго - индекс удаляемого элемента;
* CLEAR - метод должен удалять все элементы массива. В качестве первого параметра ему передается объект;
* PUSH - метод должен добавлять элемент в конец массива. В качестве первого параметра ему передается объект, а в качестве второго - добавляемое значение;
* UNSHIFT - метод должен добавлять элемент в начало массива. В качестве первого параметра ему передается объект, а в качестве второго - добавляемое значение;
* POP - метод должен извлекать и возвращать элемент с конца массива. В качестве первого параметра ему передается объект;
* SHIFT - метод должен извлекать и возвращать элемент с начала массива. В качестве первого параметра ему передается объект.

Связывание хэшей
----------------

Связываемый класс для хэш-таблицы должен включать следующие методы:

* TIEARRAY - конструктор объекта. В качестве первого параметра он получает имя класса, а в качестве остальных параметров, дополнительные параметры, передаваемые в tie;
* STORE - метод, вызываемый при записи значения элементу хэш-таблицы. В качестве первого параметра он получает объект, в качестве второго - ключ элемента; а в качестве третьего - записываемое значение;
* FETCH - метод, вызываемый при получении значения из элемента хэш-таблицы. В качестве первого параметра он получает объект, а в качестве второго - ключ целевого элемента;
* EXISTS - метод должен возвращать true - если элемент с указанным ключом задан в хэш-таблице. В качестве первого параметра ему передается объект, а в качестве второго - ключ проверяемого элемента;
* DELETE - метод должен удалять указанный элемент из хэш-таблицы. В качестве первого параметра ему передается объект, а в качестве второго - ключ удаляемого элемента;
* CLEAR - метод должен удалять все элементы хэш-таблицы. В качестве первого параметра ему передается объект;
* FIRSTKEY - метод должен устанавливать внутренний указатель хэш-таблицы на ее первый элемент. В качестве первого параметра ему передается объект;
* NEXTKEY - метод должен сдвигать внутренний указатель хэш-таблицы на один элемент. В качестве первого параметра ему передается объект, а в качестве второго - ключ элемента, на который указывал указатель до сдвига.

Связывание файловых дескрипторов
--------------------------------

