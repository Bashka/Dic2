Переменные и типы данных
Типы данных в VimScript
=======================

Все данные в VimScript делятся на следующие типы:

1. Строки ('Hello world', "Hello world\n") - строки, заключенные в двойные кавычки обрабатываются интерпретатором на предмет раскрытия спецсимволов;
1. Целые числа (1 0 -5) - данные, содержащие только числа и, возможно, знак минуса для обозначения отрицательной величины;
1. Дробные числа (2.7) - данные, содержащие только числа целой и дробной частей, разделенные точкой и, возможно, знак минуса для обозначения отрицательной величины;
1. Логический тип (1 0) - псевдотип, определяющий логические ИСТИНА и ЛОЖЬ. Значением его являются целые числа 1 и 0;
1. Массив ([1,2,3]) - массив значений, индексируемых целыми числами начиная с нуля;
1. Словарь ({'foo': 1, 'bar': 2}) - массив значений, индексируемых числовыми и строчными значениями;
1. Функции - указатель на исполняемую функцию.

Для определения типа некоторого значения используется функция:

    type(<данные>)

Данная функция возвращает одно из следующих целых чисел:

* 0 - целое число;
* 1 - строка;
* 2 - функция;
* 3 - массив;
* 4 - словарь;
* 5 - дробное число.

Переменные
==========

Переменные в VimScript могут иметь следующие области видимости:

* `g` - глобальная пользовательская переменная (по умолчанию для переменных, объявленных вне функций);
* `v` - глобальная системная переменная;
* `s` - локальная переменная скрипта;
* `b` - локальная переменная буфера;
* `w` - локальная переменная окна;
* `t` - локальная переменная вкладки (tab);
* `l` - локальная переменная функции (по умолчанию для переменных, объявленных в теле функций);
* `a` - аргумент функции.

Инициализация и объявление
--------------------------

Переменные в VimScript инициализируются вместе их объявления следующим образом:

    let <область>:<имя> = <значение> " Переменная
    let &l:<имя> = <значение> " Опция Vim
    let $<имя> = <значение> " Переменная окружения
    let @<имя> = <значение> " Регистр Vim

Если необходимо инициализировать переменную, имя которой задано в другой переменной, используется следующая команда:

    let {<переменная>} = <значение>

Здесь "переменная" должна хранить строку, представляющую имя инициализируемой переменной.

Для получения списка всех объявленных переменных, используется команда `:let`.

Для определения того, объявлена ли переменная, используется следующая функция:

    exists('<переменная>')

Функция возвращает 1 если переменная объявлена и 0 в противном случае.

Важно помнить, что имя переменной задается в виде строки. Здесь в качестве "переменной" может так же выступать имя переменной окружения, опции Vim или функции:

    exists('&filetype')
    exists('$HOME')
    exists('*myFun')
    exists('@register')
    exists('s:myVar')

Здесь в качестве "области" выступает любая из перечисленных выше областей, а в качестве "имени" может выступать любая последовательность букв, цифр и знака подчеркивания.

Константы
---------

Для создания констант в VimScript используется команда:

    lockvar <переменная>

После применения данной команды изменять переменную будет невозможно:

    let v = 'test'
    lockvar v
    echo v
    let v = 'replace' " Error

Для разблокировки переменной используется команда:

    unlockvar <переменная>

Получение значения
------------------

Для получения значения переменной необходимо указать область ее видимости и имя:

    echo <область>:<имя> " Переменная
    echo &<имя> " Опция Vim
    echo $<имя> " Переменная окружения
    echo @<имя> " Регистр Vim

Если необходимо получить значение переменной, имя которой задано в другой переменной, используется следующая команда:

    echo {<переменная>}

Удаление переменной
-------------------

Для удаления переменной используется следующая команда:

    unlet <область>:<имя>

Ниже приведен пример использования переменной:

    let s:myVar = 1
    echo s:myVar
    unlet s:myVar

Предопределенные переменные
===========================

В Vim определены следующие переменные:

* `v:beval_col` - номер столбца, над которых находится указатель мыши;
* `v:beval_bufnr` - номер буфера, над которым находится указатель мыши;
* `v:beval_lnum` - номер строки, над которой находится указатель мыши;
* `v:beval_text` - текст под указателем мыши;
* `v:beval_winnr` - номер окна, над которым находится указатель мыши;
* `v:charconvert_from` - имя кодировки исходного файла;
* `v:charconvert_to` - имя кодировки целевого файла;
* `v:ctype` - используемая кодировка;
* `v:dying` - число критических ошибок, произошедших в текущей сессии;
* `v:errmsg` - последнее сообщение об ошибке;
* `v:exception` - содержит сообщении об ошибке в блоке `catch` конструкции `try ... catch ...`;
* `v:foldlevel` - переменная используемая в опции `foldtext`, которая определяет уровень закрытой вкладки;
* `v:foldend` - переменная используемая в опции `foldtext`, которая определяет текст закрывающей строки вкладки;
* `v:foldstart` - переменная используемая в опции `foldtext`, которая определяет текст открывающей строки вкладки;
* `v:insertmode` - текущее состояние редактора (i - режим вставки, r - режим замены, v - режим выделения);
* `v:lang` - текущий язык;
* `v:lc_time` - текущее значение локали;
* `v:lnum` - номер строки для команд `foldexpr`, `formatexpr` и `indentexpr`;
* `v:mouse_win` - номер окна, в котором произошло событие клика мышкой (отсчет от 1);
* `v:mouse_lnum` - номер строки, на которой произошло событие клика мышкой;
* `v:mouse_col` - номер столбца, на котором произошло событие клика мышкой;
* `v:operator` - последняя используемая в нормальном режиме команда;
* `v:prevcount` - множитель (число повторений) последней используемой в нормальном режиме команды;
* `v:progname` - имя используемой программы;
* `v:register` - имя регистра по умолчанию;
* `v:servername` - имя сервера визуализации (сервер окон ОС);
* `v:shell_error` - сообщение последней ошибки оболочки Shell;
* `v:statusmsg` - последнее сообщение в статусбаре Vim;
* `v:swapname` - имя свап-файла;
* `v:this_session` - полное имя для последнего загруженного или сохраненного файла сессии;
* `v:throwpoint` - номер строки, в которой произошел выброс последнего исключения;
* `v:val` - значение текущего элемента в функциях `map` и `filter`;
* `v:version` - версия редактора Vim;
* `v:warningmsg` - последнее предупреждение.
